import{a as J}from"./chunk-OGX2LM4Q.js";import{a as z}from"./chunk-5ZYNLQOG.js";import{c as U}from"./chunk-J5VBJD4V.js";import{c as q}from"./chunk-GNLH4ZXC.js";import{a as D,c as j,f as A,h as W,n as Q,o as B,r as Y}from"./chunk-WPI227MY.js";import{$ as c,F as p,G as _,P as a,R as b,Ra as R,S as k,Sa as F,W as f,Ya as P,b as M,g as O,ga as i,ha as t,hb as $,ia as d,ib as L,j as V,la as C,ma as g,na as u,nb as N,pa as I,sa as m,t as h,ta as T,ua as v,wa as y,xa as S,ya as w}from"./chunk-QDZUGKDX.js";import{d as E}from"./chunk-AIZVJUQQ.js";function G(o,n){if(o&1&&(i(0,"div",5),m(1),t()),o&2){let e=u();a(),v(" ",e.errorMessage," ")}}function H(o,n){o&1&&(i(0,"div",6)(1,"div",7)(2,"span",8),m(3,"Loading..."),t()()())}function K(o,n){o&1&&(i(0,"div",6)(1,"div",1),d(2,"i",9),t(),i(3,"h3"),m(4,"Your cart is empty"),t(),i(5,"p",10),m(6,"Add some delicious food to get started!"),t(),i(7,"a",11),d(8,"i",12),m(9," Browse Restaurants "),t()())}function X(o,n){if(o&1&&(i(0,"div",34)(1,"h6",35),d(2,"i",12),m(3),t(),i(4,"p",36),d(5,"i",37),m(6),t()()),o&2){let e=u(2);a(3),v(" ",e.restaurant.name," "),a(3),v(" ",e.restaurant.address," ")}}function Z(o,n){if(o&1&&(i(0,"p",56),m(1),t()),o&2){let e=u().$implicit;a(),v(" ",e.menuItem.description," ")}}function ee(o,n){if(o&1){let e=C();i(0,"li",38)(1,"div",13)(2,"div",39)(3,"h6",35),m(4),t(),f(5,Z,2,1,"p",40),i(6,"div",41)(7,"div",42)(8,"button",43),g("click",function(){let r=p(e).$implicit,l=u(2);return _(l.updateQuantity(r,r.quantity-1))}),d(9,"i",44),t(),i(10,"input",45),w("ngModelChange",function(r){let l=p(e).$implicit;return S(l.quantity,r)||(l.quantity=r),_(r)}),g("change",function(){let r=p(e).$implicit,l=u(2);return _(l.updateQuantity(r,r.quantity))}),t(),i(11,"button",46),g("click",function(){let r=p(e).$implicit,l=u(2);return _(l.updateQuantity(r,r.quantity+1))}),d(12,"i",47),t()()(),i(13,"div",48)(14,"input",49),w("ngModelChange",function(r){let l=p(e).$implicit;return S(l.note,r)||(l.note=r),_(r)}),g("blur",function(){let r=p(e).$implicit,l=u(2);return _(l.updateNote(r,r.note||""))}),t(),i(15,"label",50),m(16,"Special instructions"),t()()(),i(17,"div",51)(18,"p",52),m(19),t(),i(20,"p",53),m(21),t()(),i(22,"div",54)(23,"button",19),g("click",function(){let r=p(e).$implicit,l=u(2);return _(l.removeItem(r))}),d(24,"i",55),t()()()()}if(o&2){let e=n.$implicit;a(4),T(e.menuItem.name),a(),c("ngIf",e.menuItem.description),a(3),c("disabled",e.quantity<=1),a(2),y("ngModel",e.quantity),a(4),I("id","note-",e.menuItem.id,""),y("ngModel",e.note),a(),I("for","note-",e.menuItem.id,""),a(4),v("$",(e.menuItem.price*e.quantity).toFixed(2),""),a(2),v("$",e.menuItem.price.toFixed(2)," each")}}function te(o,n){o&1&&(i(0,"span"),m(1,"Checkout"),t())}function ie(o,n){o&1&&(i(0,"span"),d(1,"span",57),m(2," Processing... "),t())}function ne(o,n){o&1&&(i(0,"div",58),d(1,"i",59),m(2," You'll need to log in before checkout "),t())}function re(o,n){if(o&1){let e=C();i(0,"div",13)(1,"div",14)(2,"div",15)(3,"div",16)(4,"h5",17),d(5,"i",18),m(6," Cart Items "),t(),i(7,"button",19),g("click",function(){p(e);let r=u();return _(r.clearCart())}),d(8,"i",20),m(9," Clear Cart "),t()(),i(10,"div",21),f(11,X,7,2,"div",22),i(12,"ul",23),f(13,ee,25,11,"li",24),t()()()(),i(14,"div",25)(15,"div",15)(16,"div",26)(17,"h5",17),m(18,"Order Summary"),t()(),i(19,"div",27)(20,"div",28)(21,"span"),m(22,"Subtotal"),t(),i(23,"span"),m(24),t()(),i(25,"div",28)(26,"span"),m(27,"Delivery Fee"),t(),i(28,"span"),m(29),t()(),d(30,"hr"),i(31,"div",29)(32,"span"),m(33,"Total"),t(),i(34,"span"),m(35),t()(),i(36,"button",30),g("click",function(){p(e);let r=u();return _(r.checkout())}),d(37,"i",31),f(38,te,2,0,"span",32)(39,ie,3,0,"span",32),t(),f(40,ne,3,0,"div",33),t()()()()}if(o&2){let e=u();a(11),c("ngIf",e.restaurant),a(2),c("ngForOf",e.cartItems),a(11),v("$",e.subtotal.toFixed(2),""),a(5),v("$",e.deliveryFee.toFixed(2),""),a(6),v("$",e.total.toFixed(2),""),a(),c("disabled",e.isSubmitting||e.cartItems.length===0),a(2),c("ngIf",!e.isSubmitting),a(),c("ngIf",e.isSubmitting),a(),c("ngIf",!e.authService.isLoggedIn)}}var x=class o{constructor(n,e,s,r,l){this.cartService=n;this.orderService=e;this.authService=s;this.restaurantService=r;this.router=l}cartItems=[];restaurant=null;isLoading=!1;isSubmitting=!1;errorMessage="";activeOrderId=null;destroy$=new M;ngOnInit(){this.cartService.items$.pipe(h(this.destroy$)).subscribe(n=>{this.cartItems=n}),this.cartService.activeOrderId$.pipe(h(this.destroy$)).subscribe(n=>{this.activeOrderId=n}),this.loadRestaurantDetails()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}loadRestaurantDetails(){let n=this.cartService.currentRestaurantId;n&&(this.isLoading=!0,this.restaurantService.getById(n).subscribe({next:e=>{this.restaurant=e,this.isLoading=!1},error:e=>{console.error("Error loading restaurant details",e),this.errorMessage="Could not load restaurant details",this.isLoading=!1}}))}updateQuantity(n,e){n.menuItem.id&&this.cartService.updateQuantity(n.menuItem.id,e)}updateNote(n,e){n.menuItem.id&&this.cartService.updateNote(n.menuItem.id,e)}removeItem(n){n.menuItem.id&&confirm("Are you sure you want to remove this item?")&&this.cartService.removeItem(n.menuItem.id)}clearCart(){confirm("Are you sure you want to clear your cart?")&&this.cartService.clearCart()}checkout(){return E(this,null,function*(){if(!this.authService.isLoggedIn){this.router.navigate(["/auth/login"],{queryParams:{returnUrl:"/cart"}});return}if(this.cartItems.length===0){this.errorMessage="Your cart is empty";return}if(this.isSubmitting=!0,this.errorMessage="",!this.cartService.currentRestaurantId){this.errorMessage="Restaurant information is missing",this.isSubmitting=!1;return}if(!this.activeOrderId){this.errorMessage="No active order found for this restaurant",this.isSubmitting=!1;return}try{let s=this.cartService.toOrderItems(this.activeOrderId).map(r=>this.orderService.addOrderItem(r));yield O(V(s)),this.isSubmitting=!1,this.cartService.clearCart(),this.router.navigate(["/orders",this.activeOrderId])}catch(e){console.error("Error adding items to order",e),this.errorMessage="Failed to add items to order. Please try again.",this.isSubmitting=!1}})}get subtotal(){return this.cartItems.reduce((n,e)=>n+e.menuItem.price*e.quantity,0)}get deliveryFee(){return this.restaurant?.deliveryFee||0}get total(){return this.subtotal+this.deliveryFee}static \u0275fac=function(e){return new(e||o)(b(J),b(U),b(q),b(z),b($))};static \u0275cmp=k({type:o,selectors:[["app-cart"]],decls:7,vars:4,consts:[[1,"container","py-4"],[1,"mb-4"],["class","alert alert-danger",4,"ngIf"],["class","text-center my-5",4,"ngIf"],["class","row",4,"ngIf"],[1,"alert","alert-danger"],[1,"text-center","my-5"],["role","status",1,"spinner-border"],[1,"visually-hidden"],[1,"bi","bi-cart-x",2,"font-size","5rem","color","#ccc"],[1,"text-muted"],["routerLink","/restaurants",1,"btn","btn-primary","mt-3"],[1,"bi","bi-shop","me-2"],[1,"row"],[1,"col-lg-8"],[1,"card","shadow-sm","mb-4"],[1,"card-header","bg-light","d-flex","justify-content-between","align-items-center"],[1,"mb-0"],[1,"bi","bi-cart","me-2"],[1,"btn","btn-sm","btn-outline-danger",3,"click"],[1,"bi","bi-trash","me-1"],[1,"card-body","p-0"],["class","p-3 border-bottom",4,"ngIf"],[1,"list-group","list-group-flush"],["class","list-group-item p-3",4,"ngFor","ngForOf"],[1,"col-lg-4"],[1,"card-header","bg-light"],[1,"card-body"],[1,"d-flex","justify-content-between","mb-2"],[1,"d-flex","justify-content-between","mb-3","fw-bold"],[1,"btn","btn-primary","w-100",3,"click","disabled"],[1,"bi","bi-bag-check","me-2"],[4,"ngIf"],["class","mt-3 small text-muted",4,"ngIf"],[1,"p-3","border-bottom"],[1,"mb-1"],[1,"mb-0","small","text-muted"],[1,"bi","bi-geo-alt","me-1"],[1,"list-group-item","p-3"],[1,"col-md-7"],["class","text-muted mb-1 small",4,"ngIf"],[1,"mb-2"],[1,"input-group","input-group-sm",2,"max-width","150px"],["type","button",1,"btn","btn-outline-secondary",3,"click","disabled"],[1,"bi","bi-dash"],["type","number","min","1","max","99",1,"form-control","text-center",3,"ngModelChange","change","ngModel"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[1,"bi","bi-plus"],[1,"form-floating","mb-2"],["type","text",1,"form-control","form-control-sm",3,"ngModelChange","blur","id","ngModel"],[3,"for"],[1,"col-md-3","text-end"],[1,"mb-0","fw-bold"],[1,"text-muted","small","mb-0"],[1,"col-md-2","text-end"],[1,"bi","bi-trash"],[1,"text-muted","mb-1","small"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm","me-2"],[1,"mt-3","small","text-muted"],[1,"bi","bi-info-circle","me-1"]],template:function(e,s){e&1&&(i(0,"div",0)(1,"h1",1),m(2,"Your Cart"),t(),f(3,G,2,1,"div",2)(4,H,4,0,"div",3)(5,K,10,0,"div",3)(6,re,41,9,"div",4),t()),e&2&&(a(3),c("ngIf",s.errorMessage),a(),c("ngIf",s.isLoading),a(),c("ngIf",!s.isLoading&&s.cartItems.length===0),a(),c("ngIf",!s.isLoading&&s.cartItems.length>0))},dependencies:[P,R,F,Y,D,W,j,B,Q,A,N,L],styles:[".form-control-sm[_ngcontent-%COMP%]{font-size:.875rem}.form-floating[_ngcontent-%COMP%] > .form-control-sm[_ngcontent-%COMP%]{height:calc(2.5rem + 2px);padding-top:1rem;padding-bottom:.25rem}.form-floating[_ngcontent-%COMP%] > label[_ngcontent-%COMP%]{padding:.5rem .75rem}.input-group[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]:focus{z-index:0}.card[_ngcontent-%COMP%]{border:none;box-shadow:0 .125rem .25rem #00000013}.list-group-item[_ngcontent-%COMP%]{border-left:none;border-right:none}.list-group-item[_ngcontent-%COMP%]:first-child{border-top:none}.list-group-item[_ngcontent-%COMP%]:last-child{border-bottom:none}"]})};var Ie=[{path:"",component:x}];export{Ie as CART_ROUTES};
