import{a as L,c as w}from"./chunk-PX2FVAOA.js";import{c as E}from"./chunk-PYZGNPIL.js";import{a as F}from"./chunk-VYR3CH47.js";import"./chunk-WFRWRDGB.js";import{$ as l,F as x,G as f,P as r,R as _,S as b,Sa as C,W as u,ca as O,ea as y,fa as h,fb as T,ga as a,ha as n,ia as d,la as S,ma as I,na as m,sa as s,ta as v,ua as c}from"./chunk-SWY4WTHZ.js";import"./chunk-AIZVJUQQ.js";var D=(i,t)=>t.id;function M(i,t){if(i&1&&(a(0,"div",5),s(1),n()),i&2){let e=m();r(),c(" ",e.errorMessage," ")}}function $(i,t){i&1&&(a(0,"div",6)(1,"div",7)(2,"span",8),s(3,"Loading..."),n()()())}function k(i,t){i&1&&(a(0,"div",15),d(1,"i",16),s(2," You have no active orders. "),n())}function N(i,t){if(i&1&&(a(0,"p",23)(1,"small",20),d(2,"i",29),s(3),n()()),i&2){let e=m().$implicit;r(3),c(" Your Total: $",e.userTotal.toFixed(2)," ")}}function U(i,t){if(i&1&&(a(0,"p",23)(1,"small",20),d(2,"i",30),s(3),n()()),i&2){let e=m().$implicit;r(3),c(" Delivery Fee: $",e.deliveryFeeShare.toFixed(2)," ")}}function H(i,t){if(i&1){let e=S();a(0,"div",12)(1,"div",17)(2,"div",18)(3,"div",19)(4,"span"),s(5),n(),a(6,"small",20),s(7),n()()(),a(8,"div",21)(9,"h5",22),s(10),n(),a(11,"p",23),s(12),n(),a(13,"p",23)(14,"small",20),d(15,"i",24),s(16),n()(),u(17,N,4,1,"p",25)(18,U,4,1,"p",25),n(),a(19,"div",26)(20,"button",27),I("click",function(){let p=x(e).$implicit,g=m(2);return f(g.viewOrder(p.id))}),d(21,"i",28),s(22," View Order "),n()()()()}if(i&2){let e=t.$implicit,o=m(2);r(4),O("badge rounded-pill ",o.getOrderStatusBadgeClass(e.status),""),r(),c(" ",o.getOrderStatusText(e.status)," "),r(2),v(o.formatDate(e.orderDate)),r(3),v(e.restaurantName),r(2),c("Manager: ",e.managerName,""),r(4),c(" ",(e.userItems==null?null:e.userItems.length)||0," items "),r(),l("ngIf",e.userTotal>0),r(),l("ngIf",e.deliveryFeeShare>0)}}function V(i,t){i&1&&(a(0,"div",31),d(1,"i",16),s(2," You have no order history. "),n())}function R(i,t){if(i&1&&(a(0,"p",23)(1,"small",20),d(2,"i",29),s(3),n()()),i&2){let e=m().$implicit;r(3),c(" Your Total: $",e.userTotal.toFixed(2)," ")}}function P(i,t){if(i&1&&(a(0,"p",23)(1,"small",20),d(2,"i",30),s(3),n()()),i&2){let e=m().$implicit;r(3),c(" Delivery Fee: $",e.deliveryFeeShare.toFixed(2)," ")}}function W(i,t){if(i&1&&(a(0,"p",23)(1,"small",20),d(2,"i",35),s(3),n()()),i&2){let e=m().$implicit,o=m(2);r(3),c(" Closed at: ",o.formatDate(e.closedAt)," ")}}function j(i,t){i&1&&(a(0,"p",23)(1,"span",36),d(2,"i",37),s(3," Paid "),n()())}function Y(i,t){i&1&&(a(0,"p",23)(1,"span",38),d(2,"i",39),s(3," Unpaid "),n()())}function B(i,t){if(i&1){let e=S();a(0,"div",12)(1,"div",32)(2,"div",33)(3,"div",19)(4,"span"),s(5),n(),a(6,"small",20),s(7),n()()(),a(8,"div",21)(9,"h5",22),s(10),n(),a(11,"p",23),s(12),n(),a(13,"p",23)(14,"small",20),d(15,"i",24),s(16),n()(),u(17,R,4,1,"p",25)(18,P,4,1,"p",25)(19,W,4,1,"p",25)(20,j,4,0,"p",25)(21,Y,4,0,"p",25),n(),a(22,"div",26)(23,"button",34),I("click",function(){let p=x(e).$implicit,g=m(2);return f(g.viewOrder(p.id))}),d(24,"i",28),s(25," View Details "),n()()()()}if(i&2){let e=t.$implicit,o=m(2);r(4),O("badge rounded-pill ",o.getOrderStatusBadgeClass(e.status),""),r(),c(" ",o.getOrderStatusText(e.status)," "),r(2),v(o.formatDate(e.orderDate)),r(3),v(e.restaurantName),r(2),c("Manager: ",e.managerName,""),r(4),c(" ",(e.userItems==null?null:e.userItems.length)||0," items "),r(),l("ngIf",e.userTotal>0),r(),l("ngIf",e.deliveryFeeShare>0),r(),l("ngIf",e.closedAt),r(),l("ngIf",e.userPaymentStatus===2),r(),l("ngIf",e.userPaymentStatus===1)}}function q(i,t){if(i&1&&(a(0,"div")(1,"h2",9),s(2,"Active Orders"),n(),u(3,k,3,0,"div",10),a(4,"div",11),y(5,H,23,10,"div",12,D),n(),a(7,"h2",9),s(8,"Order History"),n(),u(9,V,3,0,"div",13),a(10,"div",14),y(11,B,26,13,"div",12,D),n()()),i&2){let e=m();r(3),l("ngIf",e.activeOrders.length===0),r(2),h(e.activeOrders),r(4),l("ngIf",e.orderHistory.length===0),r(2),h(e.orderHistory)}}var A=class i{constructor(t,e,o){this.orderService=t;this.authService=e;this.router=o}activeOrders=[];orderHistory=[];isLoading=!1;errorMessage="";OrderStatus=L;ngOnInit(){if(!this.authService.isLoggedIn){this.router.navigate(["/auth/login"]);return}this.loadOrders()}loadOrders(){this.isLoading=!0,this.errorMessage="",this.orderService.getActiveOrders().subscribe({next:t=>{console.log("Active orders response:",t),this.activeOrders=this.processOrdersResponse(t),this.loadOrderHistory()},error:t=>{this.isLoading=!1,this.errorMessage=t.message||"Failed to load active orders"}})}loadOrderHistory(){this.orderService.getMyOrderHistory().subscribe({next:t=>{console.log("Order history response:",t),this.orderHistory=this.processOrdersResponse(t),this.isLoading=!1},error:t=>{this.isLoading=!1,this.errorMessage=t.message||"Failed to load order history"}})}processOrdersResponse(t){return Array.isArray(t)?t.map(e=>e.restaurantName!==void 0?e:{id:e.id||"",restaurantName:e.restaurant?.name||"Unknown Restaurant",orderDate:e.orderDate||new Date().toISOString(),closedAt:e.closedAt,status:e.status||1,managerName:e.manager?.name||"Unknown Manager",deliveryFee:e.restaurant?.deliveryFee||0,deliveryFeeShare:0,userItems:e.orderItems||[],userPaymentStatus:0,userTotal:this.calculateOrderTotal(e)}):(console.error("Expected orders array, got:",t),[])}calculateOrderTotal(t){return!t.orderItems||!Array.isArray(t.orderItems)?0:t.orderItems.reduce((o,p)=>o+(p.menuItem?.price||0)*(p.quantity||1),0)}viewOrder(t){this.router.navigate(["/orders",t])}getOrderStatusBadgeClass(t){switch(t){case 1:return"bg-success";case 2:return"bg-secondary";default:return"bg-primary"}}getOrderStatusText(t){switch(t){case 1:return"Open";case 2:return"Closed";default:return"Unknown"}}formatDate(t){return t?new Date(t).toLocaleString():"N/A"}static \u0275fac=function(e){return new(e||i)(_(w),_(E),_(T))};static \u0275cmp=b({type:i,selectors:[["app-order-list"]],decls:6,vars:3,consts:[[1,"container","py-4"],[1,"mb-4"],["class","alert alert-danger",4,"ngIf"],["class","text-center my-5",4,"ngIf"],[4,"ngIf"],[1,"alert","alert-danger"],[1,"text-center","my-5"],["role","status",1,"spinner-border"],[1,"visually-hidden"],[1,"mb-3"],["class","alert alert-info mb-4",4,"ngIf"],[1,"row","mb-5"],[1,"col-md-6","col-lg-4","mb-4"],["class","alert alert-info",4,"ngIf"],[1,"row"],[1,"alert","alert-info","mb-4"],[1,"bi","bi-info-circle","me-2"],[1,"card","h-100","border-success","shadow-sm"],[1,"card-header","bg-success","bg-opacity-10"],[1,"d-flex","justify-content-between","align-items-center"],[1,"text-muted"],[1,"card-body"],[1,"card-title"],[1,"card-text"],[1,"bi","bi-bag","me-1"],["class","card-text",4,"ngIf"],[1,"card-footer","bg-transparent"],[1,"btn","btn-outline-primary","w-100",3,"click"],[1,"bi","bi-eye","me-2"],[1,"bi","bi-currency-dollar","me-1"],[1,"bi","bi-truck","me-1"],[1,"alert","alert-info"],[1,"card","h-100","shadow-sm"],[1,"card-header","bg-light"],[1,"btn","btn-outline-secondary","w-100",3,"click"],[1,"bi","bi-calendar-check","me-1"],[1,"badge","bg-success"],[1,"bi","bi-check-circle","me-1"],[1,"badge","bg-danger"],[1,"bi","bi-exclamation-circle","me-1"]],template:function(e,o){e&1&&(a(0,"div",0)(1,"h1",1),s(2,"My Orders"),n(),u(3,M,2,1,"div",2)(4,$,4,0,"div",3)(5,q,13,2,"div",4),n()),e&2&&(r(3),l("ngIf",o.errorMessage),r(),l("ngIf",o.isLoading),r(),l("ngIf",!o.isLoading))},dependencies:[F,C],encapsulation:2})};export{A as OrderListComponent};
