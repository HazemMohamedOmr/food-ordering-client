import{a as P}from"./chunk-F7DG223B.js";import{a as k,c as N}from"./chunk-GNLH4ZXC.js";import{r as O}from"./chunk-WPI227MY.js";import{$ as l,Da as M,Ea as S,F as h,G as b,Ga as C,P as o,Qa as y,R as g,Ra as E,S as U,Sa as I,Ua as R,W as x,Ya as A,ga as i,ha as t,hb as w,ia as c,ib as L,la as _,ma as f,na as m,sa as r,ta as u,ua as v}from"./chunk-QDZUGKDX.js";import"./chunk-AIZVJUQQ.js";var T=(s,a,e)=>({"bg-danger":s,"bg-primary":a,"bg-secondary":e});function D(s,a){if(s&1&&(i(0,"div",20),r(1),t()),s&2){let e=m();o(),v(" ",e.errorMessage," ")}}function j(s,a){if(s&1&&(i(0,"div",21),r(1),t()),s&2){let e=m();o(),v(" ",e.successMessage," ")}}function V(s,a){s&1&&(i(0,"div",22)(1,"div",23)(2,"span",24),r(3,"Loading..."),t()()())}function $(s,a){s&1&&(i(0,"tr")(1,"td",25),r(2,"No users found"),t()())}function B(s,a){if(s&1){let e=_();i(0,"tr")(1,"td"),r(2),t(),i(3,"td"),r(4),t(),i(5,"td"),r(6),t(),i(7,"td")(8,"span",26),r(9),t()(),i(10,"td"),r(11),S(12,"date"),t(),i(13,"td")(14,"div",27)(15,"button",28),r(16," Change Role "),t(),i(17,"ul",29)(18,"li")(19,"button",30),f("click",function(){let p=h(e).$implicit,d=m();return b(d.updateUserRole(p,d.UserRole.Manager))}),r(20," Promote to Manager "),t()(),i(21,"li")(22,"button",30),f("click",function(){let p=h(e).$implicit,d=m();return b(d.updateUserRole(p,d.UserRole.EndUser))}),r(23," Demote to User "),t()()()()()()}if(s&2){let e=a.$implicit,n=m();o(2),u(e.name),o(2),u(e.email),o(2),u(e.phoneNumber||"N/A"),o(2),l("ngClass",M(11,T,e.role===n.UserRole.Admin,e.role===n.UserRole.Manager,e.role===n.UserRole.EndUser)),o(),v(" ",n.getRoleName(e.role||n.UserRole.EndUser)," "),o(2),u(e.createdAt?C(12,8,e.createdAt,"medium"):"N/A"),o(8),l("disabled",e.role===n.UserRole.Manager||e.id===(n.authService.currentUser==null?null:n.authService.currentUser.id)),o(3),l("disabled",e.role===n.UserRole.EndUser||e.id===(n.authService.currentUser==null?null:n.authService.currentUser.id))}}var F=class s{constructor(a,e,n){this.adminService=a;this.authService=e;this.router=n}users=[];isLoading=!1;errorMessage="";successMessage="";UserRole=k;ngOnInit(){if(!this.authService.isLoggedIn||!this.authService.isAdmin){this.router.navigate(["/"]);return}this.loadUsers()}loadUsers(){this.isLoading=!0,this.errorMessage="",this.successMessage="",this.adminService.getAllUsers().subscribe({next:a=>{this.users=a,this.isLoading=!1},error:a=>{this.isLoading=!1,this.errorMessage=a.message||"Failed to load users"}})}updateUserRole(a,e){if(a.role!==e){if(e===1){this.errorMessage="Cannot promote users to Admin through the API";return}if(a.id===this.authService.currentUser?.id){this.errorMessage="Cannot change your own role";return}this.isLoading=!0,this.errorMessage="",this.successMessage="",this.adminService.updateUserRole(a.id,e).subscribe({next:()=>{this.isLoading=!1,a.role=e,this.successMessage=`Updated ${a.name}'s role successfully`},error:n=>{this.isLoading=!1,this.errorMessage=n.message||"Failed to update user role"}})}}getRoleName(a){switch(a){case 1:return"Admin";case 2:return"Manager";case 3:return"User";default:return"Unknown"}}static \u0275fac=function(e){return new(e||s)(g(P),g(N),g(w))};static \u0275cmp=U({type:s,selectors:[["app-user-management"]],decls:40,vars:5,consts:[[1,"container","py-4"],[1,"d-flex","justify-content-between","align-items-center","mb-4"],["routerLink","/admin",1,"btn","btn-primary"],[1,"fas","fa-arrow-left","me-2"],["class","alert alert-danger",4,"ngIf"],["class","alert alert-success",4,"ngIf"],["class","text-center my-5",4,"ngIf"],[1,"card","mb-5"],[1,"card-header","bg-primary","text-white"],[1,"d-flex","justify-content-between","align-items-center"],[1,"mb-0"],[1,"fas","fa-users","me-2"],[1,"btn","btn-sm","btn-light",3,"click"],[1,"fas","fa-sync-alt","me-2"],[1,"card-body"],[1,"table-responsive"],[1,"table","table-hover"],[4,"ngIf"],[4,"ngFor","ngForOf"],[1,"mb-5","pb-5"],[1,"alert","alert-danger"],[1,"alert","alert-success"],[1,"text-center","my-5"],["role","status",1,"spinner-border"],[1,"visually-hidden"],["colspan","6",1,"text-center"],[1,"badge",3,"ngClass"],[1,"btn-group"],["type","button","data-bs-toggle","dropdown","aria-expanded","false",1,"btn","btn-sm","btn-outline-primary","dropdown-toggle"],[1,"dropdown-menu"],[1,"dropdown-item",3,"click","disabled"]],template:function(e,n){e&1&&(i(0,"div",0)(1,"div",1)(2,"h1"),r(3,"User Management"),t(),i(4,"button",2),c(5,"i",3),r(6," Back to Dashboard "),t()(),x(7,D,2,1,"div",4)(8,j,2,1,"div",5)(9,V,4,0,"div",6),i(10,"div",7)(11,"div",8)(12,"div",9)(13,"h5",10),c(14,"i",11),r(15," System Users"),t(),i(16,"button",12),f("click",function(){return n.loadUsers()}),c(17,"i",13),r(18," Refresh "),t()()(),i(19,"div",14)(20,"div",15)(21,"table",16)(22,"thead")(23,"tr")(24,"th"),r(25,"Name"),t(),i(26,"th"),r(27,"Email"),t(),i(28,"th"),r(29,"Phone"),t(),i(30,"th"),r(31,"Role"),t(),i(32,"th"),r(33,"Created"),t(),i(34,"th"),r(35,"Actions"),t()()(),i(36,"tbody"),x(37,$,3,0,"tr",17)(38,B,24,15,"tr",18),t()()()()(),c(39,"div",19),t()),e&2&&(o(7),l("ngIf",n.errorMessage),o(),l("ngIf",n.successMessage),o(),l("ngIf",n.isLoading),o(28),l("ngIf",n.users.length===0&&!n.isLoading),o(),l("ngForOf",n.users))},dependencies:[A,y,E,I,R,O,L],styles:[".table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{vertical-align:middle}.badge[_ngcontent-%COMP%]{font-size:.85rem;padding:.35em .65em}"]})};export{F as UserManagementComponent};
