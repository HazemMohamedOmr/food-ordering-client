import{B as d,_a as g,e as r,f as p,h as n,i as h,kb as m,m as c,r as o,u as s,y as C}from"./chunk-VKWVD2Y2.js";import{a as l,b as u}from"./chunk-AIZVJUQQ.js";var f=class i{constructor(e){this.http=e}apiUrl=`${m.apiUrl}/restaurants`;restaurantsCache=null;restaurantCache=new Map;lastCacheTime=0;CACHE_DURATION=6e4;getAll(){let e=Date.now();return this.restaurantsCache&&e-this.lastCacheTime<this.CACHE_DURATION?(console.log("Using cached restaurants data"),r(this.restaurantsCache)):this.http.get(this.apiUrl).pipe(n(1e4),h(t=>t.map(a=>u(l({},a),{description:a.description||"A delightful restaurant serving wonderful dishes."}))),s(t=>{console.log("Updating restaurant cache with",t.length,"restaurants"),this.restaurantsCache=t,this.lastCacheTime=e,t.forEach(a=>{a.id&&this.restaurantCache.set(a.id,a)})}),o(1),c(t=>(console.error("Error fetching restaurants:",t),this.restaurantsCache?(console.log("Returning expired cache data as fallback"),r(this.restaurantsCache)):r([]))))}getById(e){return this.restaurantCache.has(e)?(console.log("Using cached restaurant data for id:",e),r(this.restaurantCache.get(e))):this.http.get(`${this.apiUrl}/${e}`).pipe(n(5e3),s(t=>{t&&t.id&&this.restaurantCache.set(e,t)}),o(1),c(t=>{if(console.error(`Error fetching restaurant with id ${e}:`,t),this.restaurantsCache){let a=this.restaurantsCache.find(b=>b.id===e);if(a)return console.log("Using restaurant from all-restaurants cache as fallback"),r(a)}return p(()=>new Error(`Failed to load restaurant details: ${t.message||"Network error"}`))}))}create(e){return this.http.post(this.apiUrl,e).pipe(h(t=>t.data),s(()=>{this.clearCache()}))}update(e,t){return this.http.put(`${this.apiUrl}/${e}`,t).pipe(s(()=>{this.clearCache()}))}delete(e){return this.http.delete(`${this.apiUrl}/${e}`).pipe(s(()=>{this.clearCache()}))}clearCache(){console.log("Clearing restaurant cache"),this.restaurantsCache=null,this.restaurantCache.clear(),this.lastCacheTime=0}getCacheStatus(){return{restaurantsCached:this.restaurantsCache?this.restaurantsCache.length:0,individualCached:this.restaurantCache.size,age:this.lastCacheTime?Date.now()-this.lastCacheTime:0}}static \u0275fac=function(t){return new(t||i)(d(g))};static \u0275prov=C({token:i,factory:i.\u0275fac,providedIn:"root"})};export{f as a};
