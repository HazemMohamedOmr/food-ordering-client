import{$a as m,B as I,c as i,e as n,i as c,m as u,pb as l,u as d,y as o}from"./chunk-57XHIBD7.js";var v=class s{constructor(e){this.http=e;this.loadCart()}cartItems=[];cartSubject=new i([]);restaurantIdSubject=new i(null);activeOrderIdSubject=new i(null);apiUrl=`${l.apiUrl}/orders`;get items$(){return this.cartSubject.asObservable()}get restaurantId$(){return this.restaurantIdSubject.asObservable()}get activeOrderId$(){return this.activeOrderIdSubject.asObservable()}get currentRestaurantId(){return this.restaurantIdSubject.value}get currentActiveOrderId(){return this.activeOrderIdSubject.value}get totalItems(){return this.cartItems.reduce((e,t)=>e+t.quantity,0)}get totalPrice(){return this.cartItems.reduce((e,t)=>e+t.menuItem.price*t.quantity,0)}loadCart(){let e=localStorage.getItem("cart"),t=localStorage.getItem("restaurantId"),r=localStorage.getItem("activeOrderId");e&&(this.cartItems=JSON.parse(e),this.cartSubject.next([...this.cartItems])),t&&this.restaurantIdSubject.next(t),r&&this.activeOrderIdSubject.next(r)}saveCart(){localStorage.setItem("cart",JSON.stringify(this.cartItems)),this.currentRestaurantId&&localStorage.setItem("restaurantId",this.currentRestaurantId),this.currentActiveOrderId&&localStorage.setItem("activeOrderId",this.currentActiveOrderId),this.cartSubject.next([...this.cartItems])}checkActiveOrder(e){return this.http.get(`${this.apiUrl}/active/restaurant/${e}`).pipe(c(t=>t&&t.id?(this.activeOrderIdSubject.next(t.id),localStorage.setItem("activeOrderId",t.id),!0):!1),u(()=>(this.activeOrderIdSubject.next(null),localStorage.removeItem("activeOrderId"),n(!1))))}setRestaurant(e){return this.checkActiveOrder(e).pipe(d(t=>{if(t){if(this.currentRestaurantId!==null&&this.currentRestaurantId!==e&&this.cartItems.length>0)if(confirm("Adding items from a different restaurant will clear your current cart. Continue?"))this.clearCart();else return;this.restaurantIdSubject.next(e),localStorage.setItem("restaurantId",e)}}))}addToCart(e,t=1,r){if(!this.currentActiveOrderId)return alert("There is no active order for this restaurant. Please wait for the manager to start an order."),!1;let a=this.cartItems.findIndex(h=>h.menuItem.id===e.id);return a!==-1?(this.cartItems[a].quantity+=t,r&&(this.cartItems[a].note=r)):this.cartItems.push({menuItem:e,quantity:t,note:r}),this.saveCart(),!0}updateQuantity(e,t){let r=this.cartItems.findIndex(a=>a.menuItem.id===e);r!==-1&&(t<=0?this.removeItem(e):(this.cartItems[r].quantity=t,this.saveCart()))}updateNote(e,t){let r=this.cartItems.findIndex(a=>a.menuItem.id===e);r!==-1&&(this.cartItems[r].note=t,this.saveCart())}removeItem(e){this.cartItems=this.cartItems.filter(t=>t.menuItem.id!==e),this.saveCart()}clearCart(){this.cartItems=[],this.restaurantIdSubject.next(null),this.activeOrderIdSubject.next(null),localStorage.removeItem("cart"),localStorage.removeItem("restaurantId"),localStorage.removeItem("activeOrderId"),this.cartSubject.next([])}toOrderItems(e){return this.cartItems.map(t=>({menuItemId:t.menuItem.id||"",quantity:t.quantity,note:t.note||"",menuItem:t.menuItem,id:"",orderId:e,userId:""}))}static \u0275fac=function(t){return new(t||s)(I(m))};static \u0275prov=o({token:s,factory:s.\u0275fac,providedIn:"root"})};export{v as a};
